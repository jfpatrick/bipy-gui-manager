include:
 - project: acc-co/devops/python/acc-py-devtools
   file: acc_py_devtools/templates/gitlab-ci/python.yml

variables:
  project_name: bipy_gui_manager

Tests:
  image: gitlab-registry.cern.ch/acc-co/accsoft/gui/accsoft-gui-pyqt-distro/acc-py-pyqt:ci
  script:
   - source /opt/venv/bin/activate
   - yum install -y openldap-devel python-devel
   - pip install .[core,test]
   - python -m pytest --log-cli-level=DEBUG --random-order --junitxml=report.xml --cov-report
     html:coverage --cov-report term-missing:skip-covered --cov=${project_name} -vx
     --color=yes
  coverage: /TOTAL.+ ([0-9]{1,3}%)/
  artifacts:
    name: coverage-report
    paths:
     - coverage
    when: on_success
    expire_in: 1 month
    reports:
      junit: report.xml
  except:
    changes:
     - '*.md'



# A dev build of the documentation, made available through cern.ch/acc-py.
build_docs:
  extends: .acc_py_build_docs


# A release build of the documentation, made available through cern.ch/acc-py.
build_docs_on_tag:
  extends: .acc_py_build_docs_on_tag
